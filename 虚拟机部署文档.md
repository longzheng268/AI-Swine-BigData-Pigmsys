# 虚拟机部署文档

## 一、环境准备

### 1.1 虚拟机软件选择
- **VMware Workstation Pro**（推荐）或 VirtualBox
- 版本要求：VMware 15.0+ 或 VirtualBox 6.0+

### 1.2 操作系统要求
- **CentOS 7**（推荐）或 Ubuntu 20.04 LTS
- 最低配置：2核CPU、4GB内存、50GB硬盘
- 推荐配置：4核CPU、8GB内存、100GB硬盘

## 二、虚拟机创建步骤

### 2.1 创建新虚拟机
1. 打开VMware/VirtualBox，点击"创建新虚拟机"
2. 选择"典型"配置类型
3. 选择操作系统：Linux → CentOS 7 64位
4. 设置虚拟机名称：`pig-system-server`
5. 分配硬盘空间：至少50GB

### 2.2 配置虚拟机硬件
```
CPU: 4核
内存: 8GB（最小4GB）
硬盘: 50GB（动态分配）
网络适配器: NAT或桥接模式
```

### 2.3 安装操作系统
1. 挂载CentOS 7 ISO镜像文件
2. 启动虚拟机，选择"Install CentOS 7"
3. 选择语言：中文简体
4. 配置安装选项：
   - 软件选择：最小安装 + 开发工具
   - 网络配置：启用网络连接
   - 分区方案：自动分区（推荐）或手动分区
5. 设置root密码（建议使用强密码）
6. 创建普通用户（可选）
7. 完成安装并重启

## 三、系统初始化配置

### 3.1 网络配置
```bash
# 查看网络接口
ip addr show

# 编辑网络配置文件（根据实际网卡名称，通常是ens33或eth0）
sudo vi /etc/sysconfig/network-scripts/ifcfg-ens33

# 配置静态IP（可选，如需固定IP）
BOOTPROTO=static
IPADDR=192.168.100.10
NETMASK=255.255.255.0
GATEWAY=192.168.100.1
DNS1=8.8.8.8
DNS2=114.114.114.114

# 重启网络服务
sudo systemctl restart network
```

### 3.2 更新系统
```bash
# CentOS 7
sudo yum update -y

# Ubuntu
sudo apt update && sudo apt upgrade -y
```

### 3.3 安装基础工具
```bash
# CentOS 7
sudo yum install -y vim wget curl net-tools git unzip

# Ubuntu
sudo apt install -y vim wget curl net-tools git unzip
```

### 3.4 关闭防火墙（开发环境，生产环境需配置规则）
```bash
# CentOS 7
sudo systemctl stop firewalld
sudo systemctl disable firewalld

# Ubuntu
sudo ufw disable
```

### 3.5 配置SSH免密登录（可选）
```bash
# 生成密钥对
ssh-keygen -t rsa

# 复制公钥到本机
ssh-copy-id root@localhost
```

### 3.6 配置主机名和hosts
```bash
# 设置主机名
sudo hostnamectl set-hostname pig-server

# 编辑hosts文件
sudo vi /etc/hosts
# 添加：
192.168.100.10 pig-server
```

### 3.7 时间同步配置
```bash
# CentOS 7
sudo yum install -y ntpdate
sudo ntpdate -s time.nist.gov
sudo systemctl enable ntpd
sudo systemctl start ntpd

# Ubuntu
sudo apt install -y ntp
sudo systemctl enable ntp
sudo systemctl start ntp
```

## 四、安装必要软件

### 4.1 安装Java环境
```bash
# 下载JDK 11（推荐使用 OpenJDK 11）
cd /opt
sudo wget https://download.java.net/java/GA/jdk11/9/GPL/openjdk-11.0.2_linux-x64_bin.tar.gz

# 解压
sudo tar -xzf openjdk-11.0.2_linux-x64_bin.tar.gz
sudo mv jdk-11.0.2 jdk11

# 配置环境变量
sudo vi /etc/profile
# 添加：
export JAVA_HOME=/opt/jdk11
export PATH=$JAVA_HOME/bin:$PATH

# 生效配置
source /etc/profile

# 验证安装
java -version
```

### 4.2 安装MySQL
```bash
# CentOS 7
sudo yum install -y mariadb-server mariadb
sudo systemctl start mariadb
sudo systemctl enable mariadb

# 初始化数据库
sudo mysql_secure_installation

# 创建数据库和用户
sudo mysql -u root -p
CREATE DATABASE pigms CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'root'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON pigms.* TO 'root'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 4.3 安装Maven（用于构建Java项目）
```bash
cd /opt
sudo wget https://archive.apache.org/dist/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz
sudo tar -xzf apache-maven-3.8.6-bin.tar.gz
sudo mv apache-maven-3.8.6 maven

# 配置环境变量
sudo vi /etc/profile
# 添加：
export MAVEN_HOME=/opt/maven
export PATH=$MAVEN_HOME/bin:$PATH

source /etc/profile
mvn -version
```

### 4.4 安装Node.js和npm（用于前端构建）
```bash
# 使用NodeSource仓库安装Node.js 18 或 20（推荐）
curl -fsSL https://rpm.nodesource.com/setup_20.x | sudo bash -
sudo yum install -y nodejs

# 验证安装
node -v
npm -v

# 配置npm镜像（可选，加速下载）
npm config set registry https://registry.npmmirror.com
```

### 4.5 安装Python 3和pip（可选）

> **注意**: 预测算法已迁移到前端实现，通常无需安装 Python 服务。如果需要使用 Python 预测服务，可按以下步骤安装。

```bash
# CentOS 7（默认Python 2.7，需要安装Python 3）
sudo yum install -y python3 python3-pip

# 验证安装
python3 --version
pip3 --version
```

## 五、目录结构准备

```bash
# 创建项目目录
sudo mkdir -p /opt/pig-system
sudo mkdir -p /opt/pig-system/uploads
sudo mkdir -p /opt/pig-system/logs

# 设置权限
sudo chown -R $USER:$USER /opt/pig-system
```

## 六、快照备份

创建虚拟机快照，便于后续恢复：
1. 在VMware中：虚拟机 → 快照 → 拍摄快照
2. 命名为：`初始配置完成`
3. 描述：已完成系统初始化、Java、MySQL等基础软件安装

## 七、验证检查清单

- [ ] 网络连接正常，可以ping通外网
- [ ] Java环境安装成功（java -version，应显示 JDK 11 或更高版本）
- [ ] MySQL服务运行正常（systemctl status mariadb）
- [ ] Maven安装成功（mvn -version）
- [ ] Node.js和npm安装成功（node -v，应为 16.x 或更高版本; npm -v）
- [ ] Python3和pip3安装成功（可选，python3 --version）
- [ ] SSH服务运行正常
- [ ] 系统时间同步正常

## 八、常见问题

### 问题1：虚拟机无法联网
```bash
# 检查网络适配器设置（VMware：编辑 → 虚拟网络编辑器）
# 确保使用NAT或桥接模式

# 检查网络服务状态
systemctl status network
```

### 问题2：yum/apt源速度慢
```bash
# CentOS 7：更换为阿里云镜像源
sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
sudo yum makecache
```

### 问题3：磁盘空间不足
```bash
# 查看磁盘使用情况
df -h

# 清理yum缓存
sudo yum clean all
```

---



