# 前端开发与部署指南

## 快速启动

### 安装依赖

```bash
cd viewPart/pig-msys
npm install
```

### 启动开发服务器

```bash
npm run dev
```

服务将运行在 http://localhost:8081

### 构建生产版本

```bash
npm run build
```

构建产物将在 `dist/` 目录下

### 预览生产版本

```bash
npm run preview
```

## 技术架构

### 核心技术栈

- **Vue 3.5.x** - 渐进式 JavaScript 框架
- **Vite** - 下一代前端构建工具
- **TypeScript** - 类型安全的 JavaScript 超集
- **Element Plus 2.13.x** - Vue 3 UI 组件库
- **Vue Router 4.x** - 官方路由管理器
- **Pinia** - Vue 3 状态管理
- **Axios** - HTTP 客户端
- **ECharts 6.x** - 数据可视化图表库

### 项目结构

```
viewPart/pig-msys/
├── public/              # 静态资源
├── src/
│   ├── api/            # API 接口封装
│   │   ├── request.ts  # Axios 配置和拦截器
│   │   └── auth.ts     # 认证相关 API
│   ├── assets/         # 资源文件
│   ├── components/     # 公共组件
│   ├── router/         # 路由配置
│   │   └── index.ts    # 路由定义和守卫
│   ├── stores/         # Pinia 状态管理
│   ├── utils/          # 工具函数
│   │   ├── auth.ts     # Token 管理
│   │   └── prediction.ts  # 预测算法
│   ├── views/          # 页面组件
│   │   ├── login/      # 登录页
│   │   ├── prediction/ # 预测页
│   │   ├── HomeView.vue
│   │   └── AboutView.vue
│   ├── App.vue         # 根组件
│   └── main.ts         # 入口文件
├── vite.config.ts      # Vite 配置
├── tsconfig.json       # TypeScript 配置
└── package.json        # 依赖管理
```

## 核心功能

### 1. 用户认证

#### 登录流程

1. 用户输入用户名和密码
2. 前端使用 `application/x-www-form-urlencoded` 格式发送请求
3. 后端验证成功后返回 JWT Token
4. Token 存储在 localStorage
5. 后续请求自动携带 Token

#### 路由守卫

- 未登录用户自动跳转到登录页
- 已登录用户访问登录页自动跳转到首页
- Token 失效自动退出登录

### 2. 智能预测算法

#### 生长预测（predictGrowth）

**输入参数**:
- age: 日龄（天）
- feed: 饲料摄入量（kg）
- breed: 品种（白猪/黑猪/杜洛克）
- sex: 性别（公/母）

**输出结果**:
- predicted_weight: 预测体重（kg）
- growth_rate: 生长速度（kg/天）
- accuracy: 准确率
- confidence: 置信度
- suggestions: 饲养建议

**算法逻辑**:
```javascript
base_weight = 30 + age * 0.5 + feed * 10
breed_factor = breed === '白猪' ? 1.1 : 1.0
sex_factor = sex === '公' ? 1.05 : 1.0
predicted_weight = base_weight * breed_factor * sex_factor
```

#### 环境质量评价（predictEnvironment）

**输入参数**:
- temperature: 温度（℃）
- humidity: 湿度（%）
- co2: CO2浓度（ppm）
- nh3: 氨气浓度（ppm）
- light: 光照强度（lux）

**输出结果**:
- quality_level: 环境等级（I-IV）
- quality: 质量描述（优秀/良好/一般/较差）
- score: 综合评分（0-100）
- *_status: 各项指标状态
- suggestions: 改进建议

**评分规则**:
- 温度不在 18-28℃：-15 分
- 湿度不在 50-70%：-10 分
- CO2 > 600ppm：-15 分
- 氨气 > 25ppm：-20 分
- 光照不在 200-500lux：-10 分

#### 疾病风险预测（predictDisease）

**输入参数**:
- temperature: 温度（℃）
- humidity: 湿度（%）
- density: 养殖密度（头/m²）
- age: 日龄（天）
- vaccinated: 是否接种疫苗

**输出结果**:
- risk_level: 风险等级（低/中/较高/高）
- risk_probability: 风险概率
- risk_score: 风险评分
- prevention_advice: 预防建议
- suggestions: 具体改进措施

**风险评分**:
- 温度异常：+20 分
- 湿度过高：+15 分
- 密度过大：+25 分
- 日龄过小：+10 分
- 未接种疫苗：+30 分

## API 配置

### 后端代理

Vite 配置了开发环境代理：

```typescript
server: {
  port: 8081,
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '')
    }
  }
}
```

前端请求 `/api/user/login` 会被代理到 `http://localhost:8080/user/login`

### 认证配置

```typescript
// 请求拦截器自动添加 Token
config.headers['Authorization'] = `Bearer ${token}`

// 响应拦截器处理 401 错误
if (error.response.status === 401) {
  // 清除 Token，跳转登录页
  localStorage.removeItem('token')
  window.location.href = '/login'
}
```

## 开发规范

### 代码风格

- 使用 TypeScript 编写类型安全的代码
- 遵循 Vue 3 Composition API 风格
- 使用 Element Plus 组件库
- 统一使用 async/await 处理异步

### 组件规范

```vue
<script setup lang="ts">
// 导入
import { ref, reactive } from 'vue'

// 响应式数据
const loading = ref(false)
const form = reactive({})

// 方法
const handleSubmit = async () => {
  // ...
}
</script>

<template>
  <!-- 模板 -->
</template>

<style scoped>
/* 样式 */
</style>
```

## 常见问题

### 1. 端口冲突

如果 8081 端口被占用，修改 `vite.config.ts`:

```typescript
server: {
  port: 8082, // 修改为其他端口
}
```

### 2. 跨域问题

开发环境已配置代理，生产环境需要在 Nginx 配置：

```nginx
location /api/ {
    proxy_pass http://localhost:8080/;
}
```

### 3. 类型错误

运行类型检查：

```bash
npm run type-check
```

### 4. 构建优化

生产构建会自动进行：
- Tree Shaking
- 代码压缩
- 资源优化
- Chunk 分割

## 部署

### Nginx 配置示例

```nginx
server {
    listen 80;
    server_name your-domain.com;

    root /path/to/dist;
    index index.html;

    # 前端路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API 代理
    location /api/ {
        proxy_pass http://localhost:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 性能优化

1. **懒加载路由**：使用动态导入
2. **组件按需加载**：Element Plus 自动按需导入
3. **图片优化**：使用适当的图片格式和大小
4. **CDN 加速**：生产环境使用 CDN 加载第三方库

## 浏览器支持

- Chrome >= 87
- Firefox >= 78
- Safari >= 14
- Edge >= 88
